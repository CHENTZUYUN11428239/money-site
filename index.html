<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>團隊財務記帳系統</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- 漢堡選單按鈕 -->
  <button id="hamburger-btn" class="hamburger-btn" type="button" aria-label="開啟選單">
    <span></span>
    <span></span>
    <span></span>
  </button>

  <!-- 側邊欄 -->
  <div id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <h2>導覽</h2>
    </div>
    <nav class="sidebar-nav">
      <a href="#" class="sidebar-link" id="home-link">👤 個人帳本</a>
      <div class="sidebar-groups">
        <div class="sidebar-groups-header" id="groups-header">
          <span>👥 團隊帳本</span>
          <span class="expand-icon">▼</span>
        </div>
        <div class="sidebar-groups-list" id="groups-list" style="display: none;">
          <!-- Group names will be dynamically added here -->
        </div>
      </div>
    </nav>
  </div>

  <!-- 側邊欄遮罩 -->
  <div id="sidebar-overlay" class="sidebar-overlay"></div>

  <!-- 新增群組彈窗 -->
  <div id="add-group-modal" class="modal">
    <div class="modal-content">
      <span class="modal-close" id="add-group-modal-close">&times;</span>
      <h2>新增帳本／專案</h2>
      <form id="add-group-form">
        <div class="form-group">
          <label for="group-name-input">帳本名稱</label>
          <input type="text" id="group-name-input" placeholder="輸入帳本／專案名稱" required />
        </div>
        <div class="form-group">
          <label for="group-desc-input">帳本說明（選填）</label>
          <textarea id="group-desc-input" placeholder="帳本用途、部門或專案說明" rows="3"></textarea>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn primary">建立帳本</button>
          <button type="button" class="btn" id="add-group-modal-cancel">取消</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 編輯群組名稱彈窗 -->
  <div id="edit-group-name-modal" class="modal">
    <div class="modal-content">
      <span class="modal-close" id="edit-group-name-modal-close">&times;</span>
      <h2>修改帳本名稱</h2>
      <form id="edit-group-name-form">
        <div class="form-group">
          <label for="edit-group-name-input">帳本名稱</label>
          <input type="text" id="edit-group-name-input" placeholder="輸入新的帳本名稱" required />
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn primary">儲存</button>
          <button type="button" class="btn" id="edit-group-name-modal-cancel">取消</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 編輯群組說明彈窗 -->
  <div id="edit-group-modal" class="modal">
    <div class="modal-content">
      <span class="modal-close" id="edit-group-modal-close">&times;</span>
      <h2>修改帳本說明</h2>
      <form id="edit-group-form">
        <div class="form-group">
          <label for="edit-group-name">帳本名稱</label>
          <input type="text" id="edit-group-name" readonly style="background: #f5f5f5; cursor: not-allowed;" />
        </div>
        <div class="form-group">
          <label for="edit-group-desc-input">帳本說明</label>
          <textarea id="edit-group-desc-input" placeholder="帳本用途、部門或專案說明" rows="3"></textarea>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn primary">儲存</button>
          <button type="button" class="btn" id="edit-group-modal-cancel">取消</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 群組右鍵選單 -->
  <div id="group-context-menu" class="context-menu" style="display: none;">
    <div class="context-menu-item" id="context-edit-group-name">修改帳本名稱</div>
    <div class="context-menu-item" id="context-edit-group">修改帳本說明</div>
    <div class="context-menu-item" id="context-delete-group">刪除帳本</div>
  </div>

  <!-- 右上角登入/註冊區域 -->
  <div id="auth-section" class="auth-section">
    <button id="login-btn" class="auth-btn" type="button">登入</button>
    <button id="register-btn" class="auth-btn" type="button">註冊</button>
    <div id="user-info" class="user-info" style="display: none;">
      <span id="username-display"></span>
      <button id="logout-btn" class="logout-btn" type="button">登出</button>
    </div>
  </div>

  <!-- 新增群組按鈕 (固定在右側) -->
  <button id="add-group-btn" class="add-group-btn-sidebar" type="button" style="display: none;">新增帳本</button>
  
  <!-- 新增組員按鈕 (固定在右側，新增群組下方) -->
  <button id="add-member-btn-fixed" class="add-member-btn-fixed" type="button" style="display: none;">新增成員</button>
  
  <!-- 組員列表顯示區域 (固定在左側) -->
  <div id="members-display-fixed" class="members-display-fixed" style="display: none;">
    <h3>帳本成員</h3>
    <p style="font-size: 11px; color: #666; margin-bottom: 10px;">可共同編輯此帳本的成員</p>
    <div id="members-list-fixed">
      <!-- Members will be displayed here -->
    </div>
  </div>

  <!-- 主頁面 -->
  <div id="main-page" class="page-view">
    <div class="container">
      <header>
        <h1>團隊財務記帳系統</h1>
        <p class="subtitle">清楚掌握收支流向，方便做預算與報表 🧾📊</p>

      <!-- 顏色選擇按鈕 -->
      <button id="color-picker-btn" class="color-picker-btn" title="更換背景顏色" type="button">🎨</button>

      <!-- 顏色選擇面板 -->
      <div id="color-picker-panel" class="color-picker-panel">
        <div class="color-option" data-color="#f5f6f8" style="background: #f5f6f8;" title="預設灰白"></div>
        <div class="color-option" data-color="#e8f4f8" style="background: #e8f4f8;" title="淺藍"></div>
        <div class="color-option" data-color="#f0f8e8" style="background: #f0f8e8;" title="淺綠"></div>
        <div class="color-option" data-color="#fef5e7" style="background: #fef5e7;" title="淺黃"></div>
        <div class="color-option" data-color="#fce8f3" style="background: #fce8f3;" title="淺粉"></div>
        <div class="color-option" data-color="#f0e8f8" style="background: #f0e8f8;" title="淺紫"></div>
        <div class="color-option" data-color="#ffffff" style="background: #ffffff;" title="純白"></div>
        <div class="color-option" data-color="#e8e8e8" style="background: #e8e8e8;" title="淺灰"></div>
      </div>
    </header>

    <!-- 圓餅圖區塊 -->
    <section class="box" id="chart-section">
      <h3>財務分析</h3>
      <p class="subtitle small">快速掌握收入、費用與佔比</p>

      <!-- 圖表類型切換 -->
      <div class="chart-tabs">
        <button class="chart-tab active" data-type="total" type="button">總收支佔比</button>
        <button class="chart-tab" data-type="category" type="button">會計科目佔比</button>
        <button class="chart-tab" data-type="month" type="button">月別收支佔比</button>
        <select id="month-selector" class="chart-selector"></select>
        <button class="chart-tab" data-type="year" type="button">年度收支佔比</button>
        <select id="year-selector" class="chart-selector"></select>
      </div>

      <div class="chart-wrap">
        <canvas id="pieChart"></canvas>
      </div>
    </section>

    <!-- 總覽 -->
    <section id="summary" class="summary">
      <div class="card">
        <div class="card-title">總收入（Revenue）</div>
        <div id="total-income" class="kpi income">0</div>
      </div>
      <div class="card">
        <div class="card-title">總費用（Expense）</div>
        <div id="total-expense" class="kpi expense">0</div>
      </div>
      <div class="card">
        <div class="card-title">淨額（Net）</div>
        <div id="balance" class="kpi balance">0</div>
      </div>
    </section>

    <!-- 新增紀錄 -->
    <section class="box">
      <h3>新增交易紀錄</h3>
      <form id="tx-form">
        <div class="row">
          <select name="type" required>
            <option value="支出">支出</option>
            <option value="收入">收入</option>
          </select>

          <input type="number" name="amount" placeholder="金額" min="0" step="1" required />

          <!-- ✅ 這裡：加 id，並保留原本選項 -->
          <select name="category" id="category-select" required>
            <option>飲食</option>
            <option>交通</option>
            <option>娛樂</option>
            <option>其他</option>
          </select>

          <!-- ✅ 這裡：新增自訂類別輸入框（預設隱藏） -->
          <input
            type="text"
            id="custom-category"
            class="custom-category"
            placeholder="自訂會計科目（選『其他』才會出現）"
            autocomplete="off"
          />

          <input type="date" name="date" id="date-input" required />
        </div>

        <textarea name="note" placeholder="備註（可留空）"></textarea>

        <div class="actions">
          <button class="btn primary" type="submit">新增</button>
          <button class="btn danger" type="button" id="clear-all-btn">清空所有紀錄</button>
        </div>
      </form>
    </section>

    <!-- 收支紀錄 -->
    <section id="records" class="box">
      <h3>交易明細</h3>
      
      <!-- 篩選區域 -->
      <div class="filter-section">
        <div class="filter-group">
          <label>日期篩選：</label>
          <input type="number" id="filter-year" placeholder="年" min="2000" max="2100" class="filter-input" />
          <input type="number" id="filter-month" placeholder="月" min="1" max="12" class="filter-input" />
          <input type="number" id="filter-day" placeholder="日" min="1" max="31" class="filter-input" />
        </div>
        <div class="filter-group">
          <label>會計科目篩選：</label>
          <select id="filter-category" class="filter-select">
            <option value="">全部科目</option>
          </select>
        </div>
        <div class="filter-actions">
          <button id="apply-filter-btn" class="btn primary" type="button">套用篩選</button>
          <button id="clear-filter-btn" class="btn" type="button">清除篩選</button>
        </div>
      </div>
      
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>日期</th>
              <th>類型</th>
              <th class="num">金額</th>
              <th>會計科目</th>
              <th>登錄人</th>
              <th>用途／備註</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tx-tbody"></tbody>
        </table>
      </div>
    </section>
  </div>
  </div>

  <!-- 群組頁面 -->
  <div id="groups-page" class="page-view" style="display: none;">
    <div class="container">
      <header>
        <h1 id="group-title">團隊帳本</h1>
        <p class="subtitle" id="group-description">團隊共用帳本，追蹤專案／部門收支 👥📒</p>

      <!-- 顏色選擇按鈕 -->
      <button id="color-picker-btn-groups" class="color-picker-btn" title="更換背景顏色" type="button">🎨</button>

      <!-- 顏色選擇面板 -->
      <div id="color-picker-panel-groups" class="color-picker-panel">
        <div class="color-option" data-color="#f5f6f8" style="background: #f5f6f8;" title="預設灰白"></div>
        <div class="color-option" data-color="#e8f4f8" style="background: #e8f4f8;" title="淺藍"></div>
        <div class="color-option" data-color="#f0f8e8" style="background: #f0f8e8;" title="淺綠"></div>
        <div class="color-option" data-color="#fef5e7" style="background: #fef5e7;" title="淺黃"></div>
        <div class="color-option" data-color="#fce8f3" style="background: #fce8f3;" title="淺粉"></div>
        <div class="color-option" data-color="#f0e8f8" style="background: #f0e8f8;" title="淺紫"></div>
        <div class="color-option" data-color="#ffffff" style="background: #ffffff;" title="純白"></div>
        <div class="color-option" data-color="#e8e8e8" style="background: #e8e8e8;" title="淺灰"></div>
      </div>
    </header>

    <!-- 圓餅圖區塊 -->
    <section class="box" id="chart-section-groups">
      <h3>財務分析</h3>
      <p class="subtitle small">快速掌握收入、費用與佔比</p>

      <!-- 圖表類型切換 -->
      <div class="chart-tabs">
        <button class="chart-tab active" data-type="total" type="button">總收支佔比</button>
        <button class="chart-tab" data-type="category" type="button">會計科目佔比</button>
        <button class="chart-tab" data-type="member" type="button">成員分析</button>
        <button class="chart-tab" data-type="month" type="button">月別收支佔比</button>
        <select id="month-selector-groups" class="chart-selector"></select>
        <button class="chart-tab" data-type="year" type="button">年度收支佔比</button>
        <select id="year-selector-groups" class="chart-selector"></select>
      </div>

      <div class="chart-wrap">
        <canvas id="pieChart-groups"></canvas>
      </div>
    </section>

    <!-- 總覽 -->
    <section id="summary-groups" class="summary">
      <div class="card">
        <div class="card-title">總收入（Revenue）</div>
        <div id="total-income-groups" class="kpi income">0</div>
      </div>
      <div class="card">
        <div class="card-title">總費用（Expense）</div>
        <div id="total-expense-groups" class="kpi expense">0</div>
      </div>
      <div class="card">
        <div class="card-title">淨額（Net）</div>
        <div id="balance-groups" class="kpi balance">0</div>
      </div>
    </section>

    <!-- 新增群組紀錄 -->
    <section class="box">
      <h3>新增交易紀錄</h3>
      <form id="tx-form-groups">
        <div class="row">
          <select name="type" required>
            <option value="支出">支出</option>
            <option value="收入">收入</option>
          </select>

          <input type="number" name="amount" placeholder="金額" min="0" step="1" required />

          <select name="category" id="category-select-groups" required>
            <option>飲食</option>
            <option>交通</option>
            <option>娛樂</option>
            <option>其他</option>
          </select>

          <input
            type="text"
            id="custom-category-groups"
            class="custom-category"
            placeholder="自訂會計科目（選『其他』才會出現）"
            autocomplete="off"
          />

          <select name="member" id="member-select-groups" required>
            <option value="">選擇成員</option>
            <option value="其他">其他</option>
          </select>

          <input type="text" id="custom-member-groups" placeholder="輸入成員名稱" style="display: none;" />

          <input type="date" name="date" id="date-input-groups" required />
        </div>

        <textarea name="note" placeholder="備註（可留空）"></textarea>

        <div class="actions">
          <button class="btn primary" type="submit">新增</button>
          <button class="btn danger" type="button" id="clear-all-btn-groups">清空所有紀錄</button>
        </div>
      </form>
    </section>

    <!-- 群組紀錄 -->
    <section class="box">
      <h3>交易明細</h3>

      <!-- 篩選區域 -->
      <div class="filter-section">
        <div class="filter-group">
          <label>日期篩選：</label>
          <input type="number" id="filter-year-groups" placeholder="年" min="2000" max="2100" class="filter-input" />
          <input type="number" id="filter-month-groups" placeholder="月" min="1" max="12" class="filter-input" />
          <input type="number" id="filter-day-groups" placeholder="日" min="1" max="31" class="filter-input" />
        </div>
        <div class="filter-group">
          <label>會計科目篩選：</label>
          <select id="filter-category-groups" class="filter-select">
            <option value="">全部科目</option>
          </select>
        </div>
        <div class="filter-group">
          <label>成員篩選：</label>
          <select id="filter-member-groups" class="filter-select">
            <option value="">全部成員</option>
          </select>
        </div>
        <div class="filter-actions">
          <button id="apply-filter-btn-groups" class="btn primary" type="button">套用篩選</button>
          <button id="clear-filter-btn-groups" class="btn" type="button">清除篩選</button>
        </div>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>日期</th>
              <th>類型</th>
              <th class="num">金額</th>
              <th>會計科目</th>
              <th>費用歸屬</th>
              <th>登錄人</th>
              <th>用途／備註</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tx-tbody-groups"></tbody>
        </table>
      </div>
    </section>
  </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="app.js"></script>
</body>
</html>
